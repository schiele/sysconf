#!/bin/bash
set -eu
GITROOT=~/git
case "$1" in
    /*) FULLPATH="$1/";;
    *)  FULLPATH="$PWD/$1/";;
esac
pathsubst()
{
    local OLDFULLPATH="$FULLPATH/xxx"
    while test "$OLDFULLPATH" != "$FULLPATH"; do
        OLDFULLPATH="$FULLPATH"
        FULLPATH="$(sed -e "$1" <<< "$FULLPATH")"
    done
}
pathsubst 's,/\./,/,'
pathsubst 's,//,/,'
pathsubst 's,/[^/]*/\.\./,/,'
pathsubst 's,/$,,'
GITPATH="$(sed -ne "s,^$GITROOT/\([^/]*\)/\(.*\)$,\1:\2,p" <<< "$FULLPATH")"
if test -z "$GITPATH"; then
    echo >&2 "invalid pattern $1"
    false
fi
exec git clone "$GITPATH" "$FULLPATH"
